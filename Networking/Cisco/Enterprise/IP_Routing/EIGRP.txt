### EIGRP

Uses its own transport protocol, RTP, (IP protocol 88) and multicast (224.0.0.10) or unicast addresses

# EIGRP Terminology

Successor is a best path (best next-hop router) to a destination prefix
Feasible Distance (FD) is a metric of the best path
Advertised/Reported Distance (AD/RD> is the FD of a neighboring router
Feasible Successor (FS) is a backup route that meets Feasibility Condition (FC)

# EIGRP Operations consist of four Phases

Neighbor Discovery
Topology Exchange
Routing Table Update and Maintenance

# Routers automatically become EIGRP neighbors if some Hello parameters match

The Autonomous System number must match
K values must be the same
Peer's IP address must be in the router's primary IP subnet

# Topology Exchange

Neighboring routers exchange full Topology Table when the relationship comes up
Afterwards Partial Updates are sent, but only when needed

# EIGRP Metric Calculation

EIGRP calculates metric based on few components (attributes) of a route

Bandwdith (lowest), Delay (cumulative), Load (worst), Reliability (worst) and MTU
The K-values (metric weights) control what components are used during metric calculation
The default K-value settings tell a router to only look at the lowest-bandwidth link in the path (in kbps) and cumulative delay (in ten of microseconds)
Metric = (10 ** 7 / BW + DLY) * 256

# Wide Metric & RIB Scaling

IOS RIB only supports 32-bit metrics
After EIGRP DUAL, metric is scaled down to fit in the RIBDefault is to scale *1/128Can be modified with metrix rib-scale

### Named Mode Overview

Unified EIGRP configuration framework
Consolidates all EIGRP commands under a single hierarchical structure
Address Family (IPv4/IPv6)General EIGRP settings such as AS, Router ID or Stub
Address Family InterfaceClassic Mode interface-level settings, such as authentication or timers
Address Family TopologySetting directly affecting EIGRP Topology table, like variance or redistribution

# Named Mode Configuration

Define virtual process and Address Familyrouter eigrp vproc-nameaddress family [ipv4|ipv6] [unicast] [vrf vrf] autonomous-system asnEnable the process with network
Define options AF interface and/or Topology settingsaf-interface [default | interface]  settingstopology base  settings

# Name Mode Migration

Convert Classic Mode configuration to Named Mode with eigrp upgrade-cliHitless

### Load Balancing Overview

Ability to distribute traffic over more than one link- Also known as Load Sharing- Makes use of additional bandwidth- Improves convergence- Up to maximum-paths routes can be installed in the RIB on IOS

# Equal-Cost

Requires routes to have the same exact metric (FD)Traffic is shared equally among the paths
Not very common

# Unequal-Cost

Distributing traffic across routes with different metricsSuccessor and FS route(s)  Non-successor routes are never consideredControlled by variance  FS routes with a metric lower than (Successor's FD * variance)

### EIGRP Queries

A mechanism used to find an alternative path for a prefixOnly used when Successor route is lost and immediate backup (FS) is not availableRelies on QUERY and REPLY packets  - A Query is generated by the affected router to all non-stub neighbors      REPLY is sent when the route is not known      REPLY is sent if there is an alternate path known to EIGRP process      QUERY is forwarded to all other neighbors if it came from the Successor  - A router generating/forwarding the Query “goes Active” for the affected route

# Stuck-In-Active (SIA)

The default Query timeout is 3 minutes- Known as Active Timer (timers active-time)(EIGRP mode command)- An alternative path can only be used when replies to all queries are received    - Otherwise the route goes into SIA state    - SIA-Query packet is sent to all neighbors that did not Reply within 90 seconds      Adjacencies with devices that did not SIA-Reply are torn down 

Query Control Mechanisms:

Stub Router
Summarization
Route Filtering

### EIGRP Stub

# EIGRP Stub Overview

Traffic and Query control mechanism

Commonly used in Hub and Spoke environments

Traffic Control

Allows to stop transit trafficOnly subset of routing information is advertised
A stub router does not advertise EIGRP-learned routes from one neighbour to other EIGRP neighbours

Query Scoping

Stub routers are not queriedStub information is advertised in Hello packets

# EIGRP Stub Configuration

The “eigrp stub” command has several arguments

connected (default)
summary (default)
static- Requires redistribute static
redistributed- Redistribution must be configured
receive-only
leak-map rmap

### EIGRP Summarization

# Contiguous network: A single classful network end to end

# Discontiguous network: Multiple clasfful networks end to end



# EIGRP Summarization Rules

Supernet advertisements are supported
At least one specific (child) route must exist- Specific (child) routes are by default not advertised
Metric of the best summarized route is advertised for the Summary- Change with summary-metric
A Discard Route (AD 5) is by default created for the Summary

# EIGRP Summarization is another method of limiting the Query Scope

A Query received that matches a Summary (but not the exact route) is not propagatedThe “unreachable” Reply is sent back to the querying neighbor

# Automatic

At classful network boundaries to the classful network itself (network level)e.g. between 10.0.0.0/8 and 192.0.2.0/24
Disabled with no auto-summary

# Manual

Interface level ([ip] summary-address eigrp asn ip-addr mask [AD] [leak-map mname])Use Leak Map to usnuppress specific routes  Route-map “permits”

# Default Route

Represents all prefix/length combinationsThe ultimate summary
Static configurationip route 0.0.0.0 0.0.0.0 [next-hop-ip | interface]Advertise with network 0.0.0.0 or redistribute static
Summarization to 0.0.0.0/0
Default Network (ip default-network)

### Route Filtering with EIGRP

# EIGRP Route Filtering using ACL

distribute-list {ACL | prefix-list | route-map} {in | out} {interface}
Distribute-list refers to an ACL, a prefix-list, or a route-map
Distribute-list can also match an interface, but this is optional
If an interface is not matched/specified, route filtering occurs irrespective of the interface
When calling an ACL with the distribute-list command:- permit clause = advertise or accept the route- deny clause = don't advertise or don't accept route

# IP Prefix-List

IP prefix-list can examine:- Prefix and prefix-length- Range of prefixes or range of prefixes lengths
Prefix-list also uses the same concept of permit or deny clause as in ACL
Prefix-list is used to match routes not for packet filtering- permit keyword implies that the route is matched- deny keyword means the routes is not matched
Prefix-list have a default deny at the end
The command to configure prefix-list is:ip prefix-list list-name [seq seq-value] {deny|permit prefix/prefix-length} [ge ge-value] [le le-value]

# Filtering using IP Prefix-Lists

EIGRP uses the distribute-list command to call a prefix-list
The routes permitted or denied depends on the permit or deny clause in the prefix-list command itself
The command to configute distribute-list using prefix-list is as follows:distribute-list prefix <name of prefix-list> {in | out} {interface type interface number}

# Route-Maps

Route-maps provide if/then logic like in programming languages
A single route-map contains one or more route-map commands (entries)
Each route-map entry has underlying matching parameters, configured with the match command
To match all packets, the route-map clause omits the match command
A route-map can call an ACL or a prefix-list
ACLs or prefix-lists match the routes
The route-map tells what to do with the matched routes: permit or deny

# Filtering using the Route-Map

EIGRP uses the same distribute-list command to call route-map, except only the keyword of route-map is added in this command
The command with route-map is:distribute-list route-map <route-map name> {in | out} {interface type interface number}



### Metric Tuning

There are two ways to manipulate the EIGRP metric value:

Changing bandwidth and/or delay values
Using offset-list

When changing bandwidth and/or delay values, remember that units of bandwidth are kilobits/second and units of delay are tens-of-microseconds, used by EIGRP.

Changing bandwidth value is NOT recommended. Changing bandwidth may also affect other interface-level things, such as QoS (queuing, shaping, etc.)

EIGRP metric calculation can be changed by configuring the K-values (weightings).

To change K-values, use the following command:metric weights tos k1 k2 k3 k4 k5

To verify the K-values configured on any router, use the command:show ip protocols

Another way to manipulate EIGRP metric is to use the offset-list
Offset-list simply allows a value to be added to the EIGRP metric
DUAL takes place before a value is added (calculated metric + offset list = New Metric)
Offset-list is configured by using the following command:offset-list {access-list-number | access-list-name} {in | out } <offset value> [interface-type interface-number]
The “offset” value is added to both the FD and the RD
Prefixes/prefix lengths are matched using the ACL, and offset value is only applied to the routes matched by the ACL permit clause
Directions of the update message is also specified in the command, in or out
Only Standard ACLs are supported

### EIGRP Variance

By default, equal cost/metric routes are installed in the routing table.
Use the following command to alter the number of equal cost/metric routes that can be installed into the routing table:maximum-paths #
Installing more than one route in the routing table provides load-balancing or load-sharing per destination, by default.
Per-packet load balancing or sharing is also available.
Load Balancing provides faster convergence
With EIGRP, we can also do unequal metric load-balancing
This is achieved by sing variance
By default, variance is set to 1Normal behaviour - Equal Cost Load Balancing
Variance > 1Behaviour changes - Unequal Cost Load Balancing

# Configuration

Use the following command:variance <multiplier>
This multiplier is an integer between 1 and 128
Multiplied by theFD of the successor route
Feasible successor route is considered if…FD of feasible successor < FD of successor * multiplier
